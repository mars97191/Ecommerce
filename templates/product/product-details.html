{% extends 'base.html' %}
{% load static %}

{% block content %}
    <main class="main__content_wrapper">

        <!-- Start product details section -->
        <section class="product__details--section section--padding">
            <div class="container">
                <div class="row row-cols-lg-2 row-cols-md-2">
                    <div class="col">
                        <div class="product__details--media">
                            <div class="single__product--preview swiper mb-25">
                                <div class="swiper-wrapper">
                                    {% for image in images %}
                                        <div class="swiper-slide">
                                            <div class="product__media--preview__items">
                                                <a class="product__media--preview__items--link glightbox"
                                                   data-gallery="product-media-preview" href="{{ image.url }}">
                                                    <img class="product__media--preview__items--img"
                                                         src="{{ image.thumbnail.url }}" alt="product-media-img">
                                                </a>
                                                <div class="product__media--view__icon">
                                                    <a class="product__media--view__icon--link glightbox"
                                                       href="{{ image.thumbnail.url }}"
                                                       data-gallery="product-media-preview">
                                                        <svg class="product__items--action__btn--svg"
                                                             xmlns="http://www.w3.org/2000/svg" width="22.51"
                                                             height="22.443" viewBox="0 0 512 512">
                                                            <path d="M221.09 64a157.09 157.09 0 10157.09 157.09A157.1 157.1 0 00221.09 64z"
                                                                  fill="none" stroke="currentColor"
                                                                  stroke-miterlimit="10"
                                                                  stroke-width="32"></path>
                                                            <path fill="none" stroke="currentColor"
                                                                  stroke-linecap="round"
                                                                  stroke-miterlimit="10" stroke-width="32"
                                                                  d="M338.29 338.29L448 448"></path>
                                                        </svg>
                                                        <span class="visually-hidden">product view</span>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="single__product--nav swiper">
                                <div class="swiper-wrapper">
                                    {% for image in images %}
                                        <div class="swiper-slide">
                                            <div class="product__media--nav__items">
                                                <img class="product__media--nav__items--img"
                                                     src="{{ image.thumbnail.url }}"
                                                     alt="product-nav-img">
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                                <div class="swiper__nav--btn swiper-button-next">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round" class=" -chevron-right">
                                        <polyline points="9 18 15 12 9 6"></polyline>
                                    </svg>
                                </div>
                                <div class="swiper__nav--btn swiper-button-prev">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round" class=" -chevron-left">
                                        <polyline points="15 18 9 12 15 6"></polyline>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col">
                        <div class="product__details--info">
                            <h2 class="product__details--info__title mb-15">{{ product.name }}</h2>
                            <div class="product__card--price">
                                <span class="current__price">$</span><span
                                    class="current__price-{{ product.id }}">{{ product.price }}</span>
                            </div>

                            <ul class="rating product__card--rating mb-15 d-flex">
                                {% include 'product/rating.html' %}


                                <li> {{ average_rating.rating|floatformat:1 }}</li>
                                <li>
                                    <span class="rating__review--text">({{ review.count }}) Отзывы</span>
                                </li>
                            </ul>
                            <p class="product__details--info__desc mb-15">Lorem ipsum dolor sit amet consectetur
                                adipisicing elit. Aut numquam ullam is recusandae laborum explicabo id sequi
                                quisquam, ab sunt deleniti quidem ea animi facilis quod nostrum odit! Repellendus
                                voluptas suscipit cum harum.</p>
                            <div class="product__variant">


                                <div class="col">

                                    <div class="row p-3">
                                        <div class="col-6 styled-div">
                                            <label for="product-quantity" class="styled-label">Qty</label>
                                            &nbsp;
                                            <select id="product-quantity" class="styled-select">
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </div>


                                        <div class="col-6 text-end">
                                            <button type="button" id="add-to-cart-detail" value="{{ product.id }}"
                                                    class="product__card--btn primary__btn add-to-cart-btn">
                                                Добавить в корзину
                                            </button>
                                        </div>
                                    </div>


                                </div>
                                <div class="product__variant--list mb-15">
                                    <a class="variant__wishlist--icon mb-15 add-to-wishlist-btn"
                                       data-product-id="{{ product.id }}">
                                        <svg class="quickview__variant--wishlist__svg"
                                             xmlns="http://www.w3.org/2000/svg"
                                             viewBox="0 0 512 512">
                                            <path d="M352.92 80C288 80 256 144 256 144s-32-64-96.92-64c-52.76 0-94.54 44.14-95.08 96.81-1.1 109.33 86.73 187.08 183 252.42a16 16 0 0018 0c96.26-65.34 184.09-143.09 183-252.42-.54-52.67-42.32-96.81-95.08-96.81z"
                                                  fill="none" stroke="currentColor" stroke-linecap="round"
                                                  stroke-linejoin="round" stroke-width="32"></path>
                                        </svg>
                                        Добавить в Лист ожидания
                                    </a>
                                </div>
                                <div class="product__variant--list mb-15">
                                    <div class="product__details--info__meta">
                                        <p class="product__details--info__meta--list"><strong>Barcode:</strong> <span> 565461</span>
                                        </p>
                                        <p class="product__details--info__meta--list"><strong>Sky:</strong>
                                            <span>4420</span></p>
                                        <p class="product__details--info__meta--list"><strong>Vendor:</strong> <span>Belo</span>
                                        </p>
                                        <p class="product__details--info__meta--list"><strong>Type:</strong> <span>Auto Parts</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- End product details section -->

        <!-- Start product details tab section -->
        <section class="product__details--tab__section section--padding">
            <div class="container">
                <div class="row row-cols-1">
                    <div class="col">
                        <ul class="product__tab--one product__details--tab d-flex mb-30">
                            <li class="product__details--tab__list active" data-toggle="tab" data-target="#description">
                                Описание
                            </li>
                            <li class="product__details--tab__list" data-toggle="tab" data-target="#reviews">
                                Отзывы ({{ review.count }})
                            </li>
                            <li class="product__details--tab__list" data-toggle="tab" data-target="#information">
                                Характеристики
                            </li>
                        </ul>
                        <div class="product__details--tab__inner border-radius-10">
                            <div class="tab_content">
                                <div id="description" class="tab_pane active show">
                                    <div class="product__tab--content">
                                        <div class="product__tab--content__step mb-30">
                                            <h3 class="product__tab--content__title h4 mb-10">{{ product.description|safe }}</h3>
                                        </div>
                                    </div>
                                </div>

                                <div id="reviews" class="tab_pane">
                                    <div class="product__reviews">

                                        <div class="product__reviews--header">
                                            <h2 class="product__reviews--header__title h3 mb-20">Customer Reviews</h2>
                                            <div class="reviews__ratting d-flex align-items-center">
                                                {% include 'product/rating.html' %}
                                                <span class="reviews__summary--caption">{{ average_rating|floatformat:1 }} Based on {{ review.count }} reviews</span>
                                            </div>


                                            <a class="actions__newreviews--btn primary__btn" href="#writereview">Write A
                                                Review</a>
                                        </div>

                                        <div class="reviews__comment--area">
                                            {% for r in review %}
                                                <div class="reviews__comment--list d-flex">

                                                    <div class="reviews__comment--thumb">
                                                        <img src="{% static 'assets/img/other/comment-thumb1.webp' %}"
                                                             alt="comment-thumb">
                                                    </div>
                                                    <div class="reviews__comment--content">
                                                        <div class="reviews__comment--top d-flex justify-content-between">
                                                            <div class="reviews__comment--top__left">
                                                                <h3 class="reviews__comment--content__title h4">{{ r.user }}</h3>
                                                                <ul class="rating d-flex">
                                                                    {% for s in r.rating|ljust:r.rating %}
                                                                        <li class="rating__list"><span
                                                                                class="rating__icon"><svg width="14"
                                                                                                          height="13"
                                                                                                          viewBox="0 0 14 13"
                                                                                                          fill="none"
                                                                                                          xmlns="http://www.w3.org/2000/svg"><path
                                                                                d="M6.08398 0.921875L4.56055 4.03906L1.11523 4.53125C0.505859 4.625 0.271484 5.375 0.716797 5.82031L3.17773 8.23438L2.5918 11.6328C2.49805 12.2422 3.1543 12.7109 3.69336 12.4297L6.76367 10.8125L9.81055 12.4297C10.3496 12.7109 11.0059 12.2422 10.9121 11.6328L10.3262 8.23438L12.7871 5.82031C13.2324 5.375 12.998 4.625 12.3887 4.53125L8.9668 4.03906L7.41992 0.921875C7.16211 0.382812 6.36523 0.359375 6.08398 0.921875Z"
                                                                                fill="currentColor"></path></svg></span>
                                                                        </li>
                                                                    {% endfor %}
                                                                </ul>
                                                            </div>
                                                            <span class="reviews__comment--content__date">{{ r.data }}</span>
                                                        </div>
                                                        <p class="reviews__comment--content__desc">{{ r.review }}</p>
                                                    </div>

                                                </div>
                                            {% endfor %}
                                        </div>

                                        {% if make_review == True %}
                                            {% if request.user.is_authenticated %}
                                                <div id="writereview" class="reviews__comment--reply__area ">
                                                    <strong class="text-success" id="review-res"></strong>

                                                    <form action="{% url 'product:ajax_add_review' product.id %}"
                                                          id="commentForm" method="post">
                                                        {% csrf_token %}
                                                        <h3 class="reviews__comment--reply__title mb-15">Add a
                                                            review </h3>


                                                        <div class="reviews__ratting mb-20">
                                                            {{ review_form.rating }}
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-12 mb-10">
                                                                {{ review_form.review }}
                                                            </div>
                                                        </div>
                                                        <button class="primary__btn text-white" data-hover="Submit"
                                                                type="submit">SUBMIT
                                                        </button>
                                                    </form>
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                </div>


                                <div id="information" class="tab_pane">
                                    <div class="product__tab--conten">
                                        <div class="product__tab--content__step">
                                            <ul class="additional__info_list">
                                                <li class="additional__info_list--item">
                                                    {{ product.additional_info|safe }}

                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- End product details tab section -->

        <!-- Start product section -->
        <section class="product__section section--padding ">
            <div class="container">
                <div class="section__heading border-bottom mb-30">
                    <h2 class="section__heading--maintitle">You <span>may also like</span></h2>
                </div>

                <div class="product__section--inner pb-15 product__swiper--activation swiper">

                    <div class="swiper-wrapper">
                        {% for p in products %}
                            <div class="swiper-slide">
                                <article class="product__card">

                                    <div class="product__card--thumbnail">
                                        <a class="product__card--thumbnail__link display-block"
                                           href="product-details.html">
                                            <img class="product__card--thumbnail__img product__primary--img"
                                                 src="{{ p.main_image.url }}" alt="product-img">
                                            <img class="product__card--thumbnail__img product__secondary--img"
                                                 src="{{ p.main_image.url }}" alt="product-img">
                                        </a>
                                        <span class="product__badge">-14%</span>
                                        <ul class="product__card--action d-flex align-items-center justify-content-center">
                                            <li class="product__card--action__list">
                                                <a class="product__card--action__btn" title="Wishlist"
                                                   href="wishlist.html">
                                                    <svg class="product__card--action__btn--svg" width="18" height="18"
                                                         viewBox="0 0 16 13" fill="none"
                                                         xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M13.5379 1.52734C11.9519 0.1875 9.51832 0.378906 8.01442 1.9375C6.48317 0.378906 4.04957 0.1875 2.46364 1.52734C0.412855 3.25 0.713636 6.06641 2.1902 7.57031L6.97536 12.4648C7.24879 12.7383 7.60426 12.9023 8.01442 12.9023C8.39723 12.9023 8.7527 12.7383 9.02614 12.4648L13.8386 7.57031C15.2879 6.06641 15.5886 3.25 13.5379 1.52734ZM12.8816 6.64062L8.09645 11.5352C8.04176 11.5898 7.98707 11.5898 7.90504 11.5352L3.11989 6.64062C2.10817 5.62891 1.91676 3.71484 3.31129 2.53906C4.3777 1.63672 6.01832 1.77344 7.05739 2.8125L8.01442 3.79688L8.97145 2.8125C9.98317 1.77344 11.6238 1.63672 12.6902 2.51172C14.0847 3.71484 13.8933 5.62891 12.8816 6.64062Z"
                                                              fill="currentColor"></path>
                                                    </svg>
                                                    <span class="visually-hidden">Wishlist</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="product__card--content">
                                        <ul class="rating product__card--rating d-flex">
                                            <li class="rating__list">
                                            <span class="rating__icon">
                                                <svg width="14" height="13" viewBox="0 0 14 13" fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                <path d="M6.08398 0.921875L4.56055 4.03906L1.11523 4.53125C0.505859 4.625 0.271484 5.375 0.716797 5.82031L3.17773 8.23438L2.5918 11.6328C2.49805 12.2422 3.1543 12.7109 3.69336 12.4297L6.76367 10.8125L9.81055 12.4297C10.3496 12.7109 11.0059 12.2422 10.9121 11.6328L10.3262 8.23438L12.7871 5.82031C13.2324 5.375 12.998 4.625 12.3887 4.53125L8.9668 4.03906L7.41992 0.921875C7.16211 0.382812 6.36523 0.359375 6.08398 0.921875Z"
                                                      fill="currentColor"></path>
                                                </svg>
                                            </span>
                                            </li>
                                            <li class="rating__list">
                                            <span class="rating__icon">
                                                <svg width="14" height="13" viewBox="0 0 14 13" fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                <path d="M6.08398 0.921875L4.56055 4.03906L1.11523 4.53125C0.505859 4.625 0.271484 5.375 0.716797 5.82031L3.17773 8.23438L2.5918 11.6328C2.49805 12.2422 3.1543 12.7109 3.69336 12.4297L6.76367 10.8125L9.81055 12.4297C10.3496 12.7109 11.0059 12.2422 10.9121 11.6328L10.3262 8.23438L12.7871 5.82031C13.2324 5.375 12.998 4.625 12.3887 4.53125L8.9668 4.03906L7.41992 0.921875C7.16211 0.382812 6.36523 0.359375 6.08398 0.921875Z"
                                                      fill="currentColor"></path>
                                                </svg>
                                            </span>
                                            </li>
                                            <li class="rating__list">
                                            <span class="rating__icon">
                                                <svg width="14" height="13" viewBox="0 0 14 13" fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                <path d="M6.08398 0.921875L4.56055 4.03906L1.11523 4.53125C0.505859 4.625 0.271484 5.375 0.716797 5.82031L3.17773 8.23438L2.5918 11.6328C2.49805 12.2422 3.1543 12.7109 3.69336 12.4297L6.76367 10.8125L9.81055 12.4297C10.3496 12.7109 11.0059 12.2422 10.9121 11.6328L10.3262 8.23438L12.7871 5.82031C13.2324 5.375 12.998 4.625 12.3887 4.53125L8.9668 4.03906L7.41992 0.921875C7.16211 0.382812 6.36523 0.359375 6.08398 0.921875Z"
                                                      fill="currentColor"></path>
                                                </svg>
                                            </span>
                                            </li>
                                            <li class="rating__list">
                                            <span class="rating__icon"> 
                                                <svg width="14" height="13" viewBox="0 0 14 13" fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M12.4141 4.53125L8.99219 4.03906L7.44531 0.921875C7.1875 0.382812 6.39062 0.359375 6.10938 0.921875L4.58594 4.03906L1.14062 4.53125C0.53125 4.625 0.296875 5.375 0.742188 5.82031L3.20312 8.23438L2.61719 11.6328C2.52344 12.2422 3.17969 12.7109 3.71875 12.4297L6.78906 10.8125L9.83594 12.4297C10.375 12.7109 11.0312 12.2422 10.9375 11.6328L10.3516 8.23438L12.8125 5.82031C13.2578 5.375 13.0234 4.625 12.4141 4.53125ZM9.53125 7.95312L10.1875 11.75L6.78906 9.96875L3.36719 11.75L4.02344 7.95312L1.25781 5.28125L5.07812 4.71875L6.78906 1.25L8.47656 4.71875L12.2969 5.28125L9.53125 7.95312Z"
                                                          fill="currentColor"></path>
                                                </svg>
                                            </span>
                                            </li>
                                            <li class="rating__list">
                                            <span class="rating__icon"> 
                                                <svg width="14" height="13" viewBox="0 0 14 13" fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M12.4141 4.53125L8.99219 4.03906L7.44531 0.921875C7.1875 0.382812 6.39062 0.359375 6.10938 0.921875L4.58594 4.03906L1.14062 4.53125C0.53125 4.625 0.296875 5.375 0.742188 5.82031L3.20312 8.23438L2.61719 11.6328C2.52344 12.2422 3.17969 12.7109 3.71875 12.4297L6.78906 10.8125L9.83594 12.4297C10.375 12.7109 11.0312 12.2422 10.9375 11.6328L10.3516 8.23438L12.8125 5.82031C13.2578 5.375 13.0234 4.625 12.4141 4.53125ZM9.53125 7.95312L10.1875 11.75L6.78906 9.96875L3.36719 11.75L4.02344 7.95312L1.25781 5.28125L5.07812 4.71875L6.78906 1.25L8.47656 4.71875L12.2969 5.28125L9.53125 7.95312Z"
                                                          fill="currentColor"></path>
                                                </svg>
                                            </span>
                                            </li>
                                            <li>
                                                <span class="rating__review--text">(126) Review</span>
                                            </li>
                                        </ul>
                                        <h3 class="product__card--title"><a
                                                href="{{ product.get_absolute_url }}">{{ p.name|truncatechars:45 }}</a>
                                        </h3>
                                        <div class="product__card--price">
                                            <span class="current__price">${{ p.price }}</span>

                                        </div>
                                        <!-- Кнопка добавить в корзину -->
                                        <div class="product__card--footer">
                                            <input type="hidden" id="csrf_token"
                                                   value="{{ csrf_token }}">
                                            <button type="button" id="add-button"
                                                    class="add-button product__card--btn primary__btn add-to-cart-btn"
                                                    value="{{ product.id }}">
                                                <svg width="14" height="11" viewBox="0 0 14 11"
                                                     fill="none"
                                                     xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M13.2371 4H11.5261L8.5027 0.460938C8.29176 0.226562 7.9402 0.203125 7.70582 0.390625C7.47145 0.601562 7.44801 0.953125 7.63551 1.1875L10.0496 4H3.46364L5.8777 1.1875C6.0652 0.953125 6.04176 0.601562 5.80739 0.390625C5.57301 0.203125 5.22145 0.226562 5.01051 0.460938L1.98707 4H0.299574C0.135511 4 0.0183239 4.14062 0.0183239 4.28125V4.84375C0.0183239 5.00781 0.135511 5.125 0.299574 5.125H0.721449L1.3777 9.78906C1.44801 10.3516 1.91676 10.75 2.47926 10.75H11.0339C11.5964 10.75 12.0652 10.3516 12.1355 9.78906L12.7918 5.125H13.2371C13.3777 5.125 13.5183 5.00781 13.5183 4.84375V4.28125C13.5183 4.14062 13.3777 4 13.2371 4ZM11.0339 9.625H2.47926L1.86989 5.125H11.6433L11.0339 9.625ZM7.33082 6.4375C7.33082 6.13281 7.07301 5.875 6.76832 5.875C6.4402 5.875 6.20582 6.13281 6.20582 6.4375V8.3125C6.20582 8.64062 6.4402 8.875 6.76832 8.875C7.07301 8.875 7.33082 8.64062 7.33082 8.3125V6.4375ZM9.95582 6.4375C9.95582 6.13281 9.69801 5.875 9.39332 5.875C9.0652 5.875 8.83082 6.13281 8.83082 6.4375V8.3125C8.83082 8.64062 9.0652 8.875 9.39332 8.875C9.69801 8.875 9.95582 8.64062 9.95582 8.3125V6.4375ZM4.70582 6.4375C4.70582 6.13281 4.44801 5.875 4.14332 5.875C3.8152 5.875 3.58082 6.13281 3.58082 6.4375V8.3125C3.58082 8.64062 3.8152 8.875 4.14332 8.875C4.44801 8.875 4.70582 8.64062 4.70582 8.3125V6.4375Z"
                                                          fill="currentColor"></path>
                                                </svg>
                                                Добавить в корзину
                                            </button>
                                        </div>
                                    </div>

                                </article>

                            </div>
                        {% endfor %}
                    </div>

                    <div class="swiper__nav--btn swiper-button-next">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                             fill="none"
                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                             class=" -chevron-right">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </div>
                    <div class="swiper__nav--btn swiper-button-prev">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                             fill="none"
                             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                             class=" -chevron-left">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </div>
                </div>

            </div>
        </section>
        <!-- End product section -->


        <!-- Start shipping section -->
        <section class="shipping__section">
            <div class="container">
                <div class="shipping__inner style2 d-flex">
                    <div class="shipping__items style2 d-flex align-items-center">
                        <div class="shipping__icon">
                            <img src="{% static 'assets/img/other/shipping1.webp' %}" alt="icon-img">
                        </div>
                        <div class="shipping__content">
                            <h2 class="shipping__content--title h3">Free Shipping</h2>
                            <p class="shipping__content--desc">Free shipping over $100</p>
                        </div>
                    </div>
                    <div class="shipping__items style2 d-flex align-items-center">
                        <div class="shipping__icon">
                            <img src="{% static 'assets/img/other/shipping2.webp' %}" alt="icon-img">
                        </div>
                        <div class="shipping__content">
                            <h2 class="shipping__content--title h3">Support 24/7</h2>
                            <p class="shipping__content--desc">Contact us 24 hours a day</p>
                        </div>
                    </div>
                    <div class="shipping__items style2 d-flex align-items-center">
                        <div class="shipping__icon">
                            <img src="{% static 'assets/img/other/shipping3.webp' %}" alt="icon-img">
                        </div>
                        <div class="shipping__content">
                            <h2 class="shipping__content--title h3">100% Money Back</h2>
                            <p class="shipping__content--desc">You have 30 days to Return</p>
                        </div>
                    </div>
                    <div class="shipping__items style2 d-flex align-items-center">
                        <div class="shipping__icon">
                            <img src="{% static 'assets/img/other/shipping4.webp' %}" alt="icon-img">
                        </div>
                        <div class="shipping__content">
                            <h2 class="shipping__content--title h3">Payment Secure</h2>
                            <p class="shipping__content--desc">We ensure secure payment</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- End shipping section -->
    </main>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- Подключаем jQuery -->

    <script>
        $(document).ready(function () {
            $("#commentForm").submit(function (e) {
                e.preventDefault(); // Предотвращаем стандартное поведение отправки формы

                // Получаем данные формы
                const formData = $(this).serialize();

                // Выполняем AJAX-запрос
                $.ajax({
                    type: "POST",
                    url: $(this).attr("action"),
                    data: formData,
                    dataType: "json",
                    success: function (response) {
                        console.log("Отзыв сохранен в базе данных");

                        if (response.bool === true) {
                            $("#review-res").html("Отзыв успешно добавлен");
                            $("#commentForm").hide();

                            addComment(response.context.user, response.context.rating, response.context.review, response.context.date);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("Произошла ошибка при отправке запроса:", error);
                    }
                });
            });

            // Функция для добавления комментария на страницу
            function addComment(user, rating, review, date) {
                let html = '<div class="reviews__comment--area">' +
                    '<div class="reviews__comment--list d-flex">' +
                    '<div class="reviews__comment--thumb"><img src="{% static 'assets/img/other/comment-thumb1.webp' %}" alt="comment-thumb"></div>' +
                    '<div class="reviews__comment--content">' +
                    '<div class="reviews__comment--top d-flex justify-content-between">' +
                    '<div class="reviews__comment--top__left">' +
                    '<h3 class="reviews__comment--content__title h4">' + user + '</h3>' +
                    '<ul class="rating d-flex">';

                for (let i = 1; i <= 5; i++) {
                    if (i <= rating) {
                        html += '<li class="rating__list"><span class="rating__icon"><svg width="14" height="13" viewBox="0 0 14 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.08398 0.921875L4.56055 4.03906L1.11523 4.53125C0.505859 4.625 0.271484 5.375 0.716797 5.82031L3.17773 8.23438L2.5918 11.6328C2.49805 12.2422 3.1543 12.7109 3.69336 12.4297L6.76367 10.8125L9.81055 12.4297C10.3496 12.7109 11.0059 12.2422 10.9121 11.6328L10.3262 8.23438L12.7871 5.82031C13.2324 5.375 12.998 4.625 12.3887 4.53125L8.9668 4.03906L7.41992 0.921875C7.16211 0.382812 6.36523 0.359375 6.08398 0.921875Z" fill="currentColor"></path></svg></span></li>';
                    } else {
                        html += '<li class="rating__list"><span class="rating__icon"><svg width="14" height="13" viewBox="0 0 14 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6.08398 0.921875L4.56055 4.03906L1.11523 4.53125C0.505859 4.625 0.271484 5.375 0.716797 5.82031L3.17773 8.23438L2.5918 11.6328C2.49805 12.2422 3.1543 12.7109 3.69336 12.4297L6.76367 10.8125L9.81055 12.4297C10.3496 12.7109 11.0059 12.2422 10.9121 11.6328L10.3262 8.23438L12.7871 5.82031C13.2324 5.375 12.998 4.625 12.3887 4.53125L8.9668 4.03906L7.41992 0.921875C7.16211 0.382812 6.36523 0.359375 6.08398 0.921875Z" stroke="currentColor"></path></svg></span></li>';
                    }
                }

                html += '</ul>' +
                    '</div>' +
                    '<span class="reviews__comment--content__date">' + date + '</span>' +
                    '</div>' +
                    '<p class="reviews__comment--content__desc">' + review + '</p>' +
                    '</div>' +
                    '</div>' +
                    '</div>';

                $(".reviews__comment--area").prepend(html);


            }
        })
        ;
    </script>








{% endblock %}



